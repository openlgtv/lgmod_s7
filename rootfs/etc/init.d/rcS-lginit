#!/bin/sh

# LG lginit
export LOG_CALLER=NO
export OSAMEM_SIZE=0x200000
export LOAD_SYM=1
export HOOK_SEGV=YES
export IS_NFS=NO
export TERM=vt100
export ADDON_SYS_PATH=/mnt/addon
export ADDON_RES_PATH=/mnt/addon/res
export ADDON_APP_CTRL=addon_mgr
export ADDON_APP_BATCH_LIST=addon_mgr.bat
export FLASH_APP_NAME=/mnt/addon/stagecraft/bin/stagecraft
export FLASH_EMANUAL_PATH=/mnt/addon/contents/emanual/emmanager.swf

# LG after lginit
export OSAINIT='done'


# BCM lginit sh script
mount -t jffs2 /dev/mtdblock9 /mnt/lg/cmn_data; #-o noatime
if [ -z "$RCS_LGINIT_ERASE" ]; then
	if [ "$?" -ne "0" ]; then
		echo 'rcS lginit: Erase /dev/mtd9' > /dev/kmsg
		/bin/flash_eraseall /dev/mtd9
		mount -t jffs2 /dev/mtdblock9 /mnt/lg/cmn_data; #-o noatime
	fi
fi
mount -t jffs2 /dev/mtdblock11 /mnt/lg/user; #-o noatime
if [ -z "$RCS_LGINIT_ERASE" ]; then
	if [ "$?" -ne "0" ]; then
		echo 'rcS lginit: Erase /dev/mtd11' > /dev/kmsg
		/bin/flash_eraseall /dev/mtd11
		mount -t jffs2 /dev/mtdblock11 /mnt/lg/user; #-o noatime
	fi
fi

# LG rc.sysinit
mount -a

# LG rc.local and BCM lginit sh script
APP_XIP=`cat /proc/cmdline | awk -v RS='[ ]' -F= '/appxip_addr=/ { print $2 }'`
if [ "${APP_XIP}" != "" ] && [ "${APP_XIP}" != "0x0" ]; then
	echo 'rcS lginit: cramfs lgapp_xip' > /dev/kmsg
	mount -t cramfs lgapp_xip /mnt/lg/lgapp -o physaddr=${APP_XIP}
else
	echo 'rcS lginit: squashfs /mnt/lg/lgapp' > /dev/kmsg
	mount -t squashfs /dev/mtdblock21 /mnt/lg/lgapp
fi
FONT_XIP=`cat /proc/cmdline | awk -v RS='[ ]' -F= '/fontxip_addr=/ { print $2 }'`
if [ "${FONT_XIP}" != "" ] && [ "${FONT_XIP}" != "0x0" ]; then
	echo 'rcS lginit: cramfs lgfont_xip' > /dev/kmsg
	#mount -t cramfs lgfont_xip /mnt/lg/res/lgfont -o physaddr=0xf100000
	mount -t cramfs lgfont_xip /mnt/lg/res/lgfont -o physaddr=${FONT_XIP}
else
	echo 'rcS lginit: squashfs /mnt/lg/res/lgfont' > /dev/kmsg
	mount -t squashfs /dev/mtdblock18 /mnt/lg/res/lgfont
fi
